/*!
 * vue-gapi v0.3.1
 * (c) 2020 CedricPoilly
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VueGapi={})}(this,function(e){"use strict";var i,r=(i="https://apis.google.com/js/api.js",new Promise(function(t,a){var n=document.createElement("script");n.src=i,n.onreadystatechange=n.onload=function(){var e=setInterval(function(){n.readyState&&!/loaded|complete/.test(n.readyState)||(clearInterval(e),console.log("gapi.js loaded."),t())},100)},n.onerror=function(e,t,n,i,o){console.log("gapi.js not loaded."),a({message:e,url:t,line:n,column:i,error:o})},document.getElementsByTagName("head")[0].appendChild(n)}));function t(e,t){var n="The "+e+" Vue instance method is deprecated and will be removed in a future release.";return t&&(n+=" Please use "+t+" instead."),n}function a(t,n){return[function(e){return"function"==typeof t&&t(e),e},function(e){return"function"==typeof n&&n(e),Promise.reject(e)}]}function n(){this.authenticated=this.isAuthenticated(),this.authInstance=null,this.clientConfig=null,this.offlineAccessCode=null,this.getOfflineAccessCode=this.getOfflineAccessCode.bind(this),this.grantOfflineAccess=this.grantOfflineAccess.bind(this),this.login=this.login.bind(this),this.refreshToken=this.refreshToken.bind(this),this.logout=this.logout.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this),this.isSignedIn=this.isSignedIn.bind(this),this.listenUserSignIn=this.listenUserSignIn.bind(this)}n.prototype._expiresAt=function(e){return JSON.stringify(1e3*e.expires_in+(new Date).getTime())},n.prototype._setStorage=function(e,t){void 0===t&&(t=null),localStorage.setItem("gapi.access_token",e.access_token),localStorage.setItem("gapi.id_token",e.id_token),localStorage.setItem("gapi.expires_at",this._expiresAt(e)),t&&(localStorage.setItem("gapi.id",t.getId()),localStorage.setItem("gapi.full_name",t.getName()),localStorage.setItem("gapi.first_name",t.getGivenName()),localStorage.setItem("gapi.last_name",t.getFamilyName()),localStorage.setItem("gapi.image_url",t.getImageUrl()),localStorage.setItem("gapi.email",t.getEmail()))},n.prototype._clearStorage=function(){localStorage.removeItem("gapi.access_token"),localStorage.removeItem("gapi.id_token"),localStorage.removeItem("gapi.expires_at"),localStorage.removeItem("gapi.id"),localStorage.removeItem("gapi.full_name"),localStorage.removeItem("gapi.first_name"),localStorage.removeItem("gapi.last_name"),localStorage.removeItem("gapi.image_url"),localStorage.removeItem("gapi.email")},n.prototype._setOfflineAccessCode=function(e){if(!e.code)throw new Error("Offline access code missing from result",e);this.offlineAccessCode=e.code},n.prototype._setSession=function(){var e=this.authInstance.currentUser.get().getBasicProfile(),t=this.authInstance.currentUser.get().getAuthResponse(!0);this._setStorage(t,e),this.authenticated=!0},n.prototype.getOfflineAccessCode=function(){return this.offlineAccessCode},n.prototype.grantOfflineAccess=function(){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.grantOfflineAccess().then(this._setOfflineAccessCode.bind(this))},n.prototype.hasGrantedRequestedScopes=function(){if(!this.authInstance)throw new Error("gapi not initialized");var e=this.clientConfig.scope,t=!0;return e&&(t=this.authInstance.currentUser.get().hasGrantedScopes(e)),t},n.prototype.login=function(e,t){var n,o=this;if(!this.authInstance)throw new Error("gapi not initialized");return(n=new Promise(function(i,t){return o.authInstance.signIn().then(function(){if(o._setSession(),o.clientConfig.refreshToken)return o.authInstance.grantOfflineAccess();var e=o.hasGrantedRequestedScopes();return i({hasGrantedScopes:e})}).then(function(e){void 0===e&&(e=null);var t=this.hasGrantedRequestedScopes();if(!e)return i({hasGrantedScopes:t});var n=e.code;localStorage.setItem("gapi.refresh_token",n),i({hasGrantedScopes:t})}).catch(function(e){console.error(e),t(e)})})).then.apply(n,a(e,t))},n.prototype.refreshToken=function(){var t=this;if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.currentUser.get().reloadAuthResponse().then(function(e){return t._setStorage(e),e})},n.prototype.grant=function(e,t){var n,o=this;if(!this.authInstance)throw new Error("gapi not initialized");return(n=new Promise(function(t,n){var e=o.authInstance.currentUser.get();if(o.hasGrantedRequestedScopes())return t(e);var i=o.clientConfig.scope;e.grant({scope:i}).then(function(e){t(e)},function(e){n(e)})})).then.apply(n,a(e,t))},n.prototype.logout=function(e,t){var n,i=this;if(!this.authInstance)throw new Error("gapi not initialized");return(n=new Promise(function(e,t){i.authInstance.signOut().then(function(){i._clearStorage(),i.authenticated=!1,e()},function(e){t(e)})})).then.apply(n,a(e,t))},n.prototype.isAuthenticated=function(){var e=JSON.parse(localStorage.getItem("gapi.expires_at"));return(new Date).getTime()<e},n.prototype.isSignedIn=function(){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.currentUser.get().isSignedIn()},n.prototype.listenUserSignIn=function(e){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.isSignedIn.listen(e),!!this.authInstance.currentUser.get().isSignedIn()&&this.getUserData()},n.prototype.getUserData=function(){return{id:localStorage.getItem("gapi.id"),firstName:localStorage.getItem("gapi.first_name"),lastName:localStorage.getItem("gapi.last_name"),fullName:localStorage.getItem("gapi.full_name"),email:localStorage.getItem("gapi.email"),imageUrl:localStorage.getItem("gapi.image_url"),expiresAt:localStorage.getItem("gapi.expires_at"),accessToken:localStorage.getItem("gapi.access_token"),idToken:localStorage.getItem("gapi.id_token")}};var s=new n,c=s.getOfflineAccessCode,l=s.getUserData,g=s.grant,u=s.grantOfflineAccess,p=s.isAuthenticated,f=s.isSignedIn,h=s.listenUserSignIn,d=s.login,m=s.logout,I=s.refreshToken,o={install:function(o,a){var e;o.gapiLoadClientPromise=null,s.clientConfig=(e=a,JSON.parse(JSON.stringify(e)));o.prototype.$gapi={getGapiClient:function(){return new Promise(function(e,t){if(o.gapiLoadClientPromise&&0===o.gapiLoadClientPromise.status)return e(window.gapi);var n,i;n=e,i=t,r.then(function(){var e=window.gapi;e?e.auth?n(e):e.load("client:auth2",function(){o.gapiLoadClientPromise=e.client.init(a).then(function(){console.info("gapi client initialised."),s.authInstance=e.auth2.getAuthInstance(),o.gapiLoadClientPromise.status=0,n(e)}).catch(function(e){var t;e.error&&(t=e.error,console.error("Failed to initialize gapi: %s (status=%s, code=%s)",t.message,t.status,t.code,e)),i(e)})}):console.error("Failed to load gapi!")})})},getOfflineAccessCode:c,grantOfflineAccess:function(){return o.prototype.$gapi.getGapiClient().then(u).then(function(){s.authInstance.grantOfflineAccess().then(function(e){console.log(e);var t=e.code;localStorage.setItem("gapi.refresh_token",t)}).catch(console.error)})},login:function(e,t){return o.prototype.$gapi.getGapiClient().then(function(){return d(e,t)})},refreshToken:function(){return o.prototype.$gapi.getGapiClient().then(I)},logout:function(e,t){return o.prototype.$gapi.getGapiClient().then(function(){return m(e,t)})},grant:function(e,t){return o.prototype.$gapi.getGapiClient().then(function(){return g(e,t)})},listenUserSignIn:function(e){return o.prototype.$gapi.getGapiClient().then(function(){return h(e)})},isSignedIn:function(){return o.prototype.$gapi.getGapiClient().then(f)},isAuthenticated:p,getUserData:l},o.prototype.isGapiLoaded=function(){return console.warn(t("isGapiLoaded")),o.gapiLoadClientPromise&&0===o.gapiLoadClientPromise.status},o.prototype.$getGapiClient=function(){return console.warn(t("$getGapiClient","$gapi.getGapiClient")),o.prototype.$gapi.getGapiClient()},o.prototype.$login=function(){return console.warn(t("$login","$gapi.login")),o.prototype.$gapi.login()},o.prototype.$refreshToken=function(){return console.warn(t("$refreshToken","$gapi.refreshToken")),o.prototype.$gapi.refreshToken()},o.prototype.$logout=function(){return console.warn(t("$logout","$gapi.logout")),o.prototype.$gapi.logout()},o.prototype.$isAuthenticated=function(){return console.warn(t("$isAuthenticated","$gapi.isAuthenticated")),o.prototype.$gapi.isAuthenticated()},o.prototype.$isSignedIn=function(){return console.warn(t("$isAuthenticated","$gapi.isAuthenticated")),o.prototype.$gapi.isSignedIn()},o.prototype.$getUserData=function(){return console.warn(t("$getUserData","$gapi.getUserData")),o.prototype.$gapi.getUserData()}}};function S(e,t){e.use(o,t)}"undefined"!=typeof window&&window.Vue&&window.Vue.use(S);e.default=S,e.version="0.3.1",Object.defineProperty(e,"__esModule",{value:!0})});